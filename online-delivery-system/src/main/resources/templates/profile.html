<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P2P Online Delivery Platform - Profile Page</title>
    <link rel="stylesheet" href="/css/profile.css/">
</head>
<body>

<header>
    <h1>User Profile</h1>
</header>

<ul class="banner">
    <li><img src="images/logo_ld_png.png"></li>
    <li><a target="_parent" href="home">Home</a></li>
    <!--<li class="active"><a target="_parent" href="about">About Us</a></li>-->
    <li><a target="_parent" href="about">About</a></li>
    <li><a target="_parent" href="order">Order</a></li>
    <li><a target="_parent" href="contact">Contact</a></li>
    <li class="right"><a target="_parent" href="login">Login</a></li>
    <li class="right"><a target="_parent" href="customerlogin">Sign up</a></li>
    <li class="right"><a target="_parent" href="restaurantlogin">Partner with us</a></li>
</ul>

<div id="profile-container">
    <div id="profile-picture">
        <input type="file" id="imageInput" accept="image/*" onchange="updateProfilePicture()">
        <label for="imageInput"><img src="/images" alt="Press To Enter Profile Picture" id="previewImage"></label>
        <!--<img src="profile-picture.jpg" alt="Profile Picture">-->
    </div>
    <div id="user-details">
        <div class="editable" id="userName">
            <h1 contenteditable="true">Anthony Price</h1>
            <button onclick="editDetails('userName')">Edit</button>
        </div>
        <div class="editable" id="userJob">
            <h2 contenteditable="true">Web Developer</h2>
            <button onclick="editDetails('userJob')">Edit</button>
        </div>
        <div class="editable" id="userDescription">
            <p contenteditable="true">This is a paragraph for the description of the user</p>
            <button onclick="editDetails('userDescription')">Edit</button>
        </div>
        <button onclick="saveProfile()">Save Profile</button>
        <button class="subscription-button">View subscription</button>
        <button class="logout-button">Logout</button>
    </div>
</div>


<img src="images/background-aboutus.jpg" alt="" class="background-image">

<script>
    function updateProfilePicture() {
        var input = document.getElementById('imageInput');
        var preview = document.getElementById('previewImage');

        var file = input.files[0];

        if (file) {
            var reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    }

    function saveProfile() {
        var userName = document.getElementById('userName').innerText;
        var userJob = document.getElementById('userJob').innerText;
        var userDescription = document.getElementById('userDescription').innerText;
        var profileData = {
            userName: userName,
            userJob: userJob,
            userDescription: userDescription,
            profilePicture: document.getElementById('previewImage').src
        };

        // Convert the profileData object to a JSON string
        var profileDataString = JSON.stringify(profileData);

        // Store the JSON string in the local storage
        sessionStorage.setItem('userProfile', profileDataString);

        // Inform the user that the profile has been saved
        alert("Profile saved!");
    }
    function editDetails(elementId) {
        var editableElement = document.getElementById(elementId);
        var content = editableElement.querySelector('[contenteditable="true"]').innerText;

        // Store the current content in sessionStorage for use on the editing page
        sessionStorage.setItem('editContent', content);

        //check if the content is non-empty before redirecting
        if (content.trim() !== "") {
            window.location.href = '/templates/edit-details.html';
        }
    }

    /*window.onload = function () {
        var storedProfile = sessionStorage.getItem('userProfile');
        if (storedProfile) {
            // Parse the stored JSON string back into an object
            var profileData = JSON.parse(storedProfile);

            // Set the values on the page based on the stored profile data
            document.getElementById('userName').innerText = profileData.userName;
            document.getElementById('userJob').innerText = profileData.userJob;
            document.getElementById('userDescription').innerText = profileData.userDescription;
            document.getElementById('previewImage').src = profileData.profilePicture;
        }
    };*/

    document.addEventListener('DOMContentLoaded', function() {
        var storedProfile = sessionStorage.getItem('userProfile');
        if (storedProfile) {
            // Parse the stored JSON string back into an object
            var profileData = JSON.parse(storedProfile);

            // Set the values on the page based on the stored profile data
            document.getElementById('userName').innerText = profileData.userName;
            document.getElementById('userJob').innerText = profileData.userJob;
            document.getElementById('userDescription').innerText = profileData.userDescription;
            document.getElementById('previewImage').src = profileData.profilePicture;
        }
    });

</script>
</body>
</html>